{% extends "coachreports/base.html" %}
{% load i18n %}
{% load staticfiles %}
{% load my_filters %}

{% block coachreports_active %}{% endblock coachreports_active %}
{% block selfreports_active %}active{% endblock selfreports_active %}

{% block title %}{% trans "User report" %} {{ block.super }}{% endblock title%}
{% block report_title %}{% trans "User report" %}{% endblock report_title %}

{% block headcss %}{{ block.super }}
    <style>
        table, th, td {
            border: 1px solid black;
        }
        .super-header {
            background-color: #ccc;
            font-weight: bold;
        }
        th {
            color: #555;
        }
        th, td {
            padding: 3px;
        }
        div.invisible {
            display:none;
        }
        td.pct, td.float, td.int, td.date {
            text-align: right;
        }
        td.date { border: 0px; }
        td.struggling {
            background-color: #aa0;
            font-weight: bold;
        }
        .table-title {
            margin-bottom: 15px;
        }
        .column {
			width: 30%;
			float: left;
			margin-bottom: 20%;
			text-align: center;
        } 
        .progressindicator{
            width:20px;
            height:20px;
            border-radius: 50%/50%;
            float: left;
            margin: 5px;
        }
        .progresswrapper{
            display: inline-block; 
            max-width: 150px;  
        }
        .completed {
            background:#338533;
        }
        .inprogress {
            background:#B2D1B2;
        }
        .inprogress2 {
            background:#B2D1B2;
        }
        .struggling {
            background:#FFCCCC;
        }
        .progressbox {
        	width: 250px;
            display: none;
        }
        .completedbox {
            border: 3px solid #338533;
        }
        .inprogressbox {
            border: 3px solid #B2D1B2;
        }
        .strugglingbox {
            border: 3px solid #FFCCCC;
        }
        
    </style>
{% endblock headcss %}

{% block navbar_topics %}{% endblock navbar_topics %}
{% block navbar_makelink %}{% endblock navbar_makelink %}
{% block navbar_facilities %}{% endblock %}
{% block navbar_groups %}
    {% block navbar_user %}
    {% if student %}
    <div id="select-user" class="selection">
        <span id="user">{{ student.get_name }}</span>
    </div>
    {% endif %}
    {% endblock navbar_user %}
{% endblock navbar_groups %}

{% block content %}
    {% block navbar %}{{ block.super }}{% endblock navbar %}

    {% block student_report %}
    <!-- {% blocktrans %}Last login time: {{ last_login_time }}{% endblocktrans %}-->

    {% if no_data %}
        {% if request.is_admin or is_central %}
            {% trans "No data for this user." %}
        {% else %}
            {% trans "Welcome to KA Lite!" %}
            {% trans "Please return to this page after watching videos or practicing exercises." %}
        {% endif %}
    {% else %}

    <h2 class="table-title">{% trans "Mastery of Topics" %}</h2>

    {% for topic in topics %}
        <div class=" column {% if exercise_logs|get_item:topic.id or video_logs|get_item:topic.id%}visible{% else %}invisible{% endif %}"> 
                <span title="{% trans topic.description %}">
                    {% if not is_central %}
                        <a href="{{ topic.path }}">{% trans topic.title %}</a>
                    {% else %}
                        {% trans topic.title %}
                    {% endif %}
                </span>
            <br>
            <div>
            {% for def in stat_defs %}
            <span class=" {{ def.type }}{% if def.key == 'total_struggling' and stats|get_item:topic.id|get_item:def.key > 0 %} struggling{% endif %}">
                {% if def.type == "date" %}
                    {{ stats|get_item:topic.id|get_item:def.key|date:"SHORT_DATE_FORMAT" }}
                {% endif %}
            </span>
            {% endfor %}
            </div>
            <div class = "progresswrapper">
            {% for subtopic in subtopics|get_item:topic.id %}
                {% if stats|get_item:subtopic.id %} 
                {% if stats|get_item:subtopic.id|get_item:"ex:pct_mastery" == 1 %}
                    <div class = "completed progressindicator" subtopic = "{{ subtopic.id }}" > </div>
                    <div class = "completedbox progressbox" id = "{{ subtopic.id }}">
                        <h5> {{ subtopic.title }} </h5>
                        <br> Mastered
                        <br>
                        <br> Completed {{ stats|get_item:subtopic.id|get_item:"ex:total_mastered" }} Exercises
                        <br>
                        <br> Watched {{ stats|get_item:subtopic.id|get_item:"vid:total_completed" }} Videos
            		</div>
                {% elif stats|get_item:subtopic.id|get_item:"ex:pct_mastery" > 0 %}
                    <div class = "inprogress progressindicator" subtopic = "{{ subtopic.id }}"> </div>
                    <div class = "inprogressbox progressbox" id = "{{ subtopic.id }}">
             			<h5> {{ subtopic.title }} </h5>
             			<br> In Progress
             			<br>
             		 {% if stats|get_item:subtopic.id|get_item:"ex:inprogress" %}
             			<br> Exercises in Progress
             			{% if exercise_logs|get_item:subtopic.id %}
             		        {% for exerciselog in exercise_logs|get_item:subtopic.id %}
             			        {% if not exerciselog.complete %} 
             			        {% for exercise in exercises|get_item:subtopic.id %}
             			            {% if exercise.name = exerciselog.exercise_id %}
             			               <div> <a href= "{{ exercise.path }}"> {{exercise.title}} </a> </div>
             			            {% endif %}
             			        {% endfor %}
             			        {% endif %} 
             			    {% endfor %}
             			{% endif %}
             		 {% else %}     
             			<br> No exercises currently in progress!
             			{% if stats|get_item:subtopic.id|get_item:"ex:nextexercise" %}
             			<br> Start next exercise!
             			     {% with exercise=stats|get_item:subtopic.id|get_item:"ex:nextexercise" %}
             			         <div> <a href= "{{ exercise.path }}"> {{exercise.title}} </a> </div>
             			     {% endwith %}
             			{% endif %}
             		 {% endif %}
             		 {% if stats|get_item:subtopic.id|get_item:"vid:inprogress" %}
             			<br> Videos in Progress
             			{% if video_logs|get_item:subtopic.id %}
             		        {% for videolog in video_logs|get_item:subtopic.id %}
             			        {% if not videolog.complete %} 
             			        {% for video in videos|get_item:subtopic.id %}
             			            {% if video.id = videolog.video_id %}
             			               <div> <a href= "{{ video.path }}"> {{video.title}} </a> </div>
             			            {% endif %}
             			        {% endfor %}
             			        {% endif %} 
             			    {% endfor %}
             			{% endif %}
             		 {% else %}     
             			<br> No videos currently being watched!
             			{% if stats|get_item:subtopic.id|get_item:"vid:nextvideo" %}
             			<br> Watch the next video!
             			     {% with video=stats|get_item:subtopic.id|get_item:"vid:nextvideo" %}
             			         <div> <a href= "{{ video.path }}"> {{video.title}} </a> <div> 
             			     {% endwith %}
             			{% endif %}
             		 {% endif %}
            		</div>
                {% elif stats|get_item:subtopic.id|get_item:"ex:total_struggling" > 0 %}
                    <div class = "struggling progressindicator" subtopic = "{{ subtopic.id }}"> </div>
                    <div class = "strugglingbox progressbox" id = "{{ subtopic.id }}">
             			<h5> {{ subtopic.title }} </h5>
             			<br> Struggling
             			<br>
             			<br> You are currently struggling in these exercises!
            			<br> 
            			{% for exerciselog in exercise_logs|get_item:subtopic.id %}
             			    {% if exerciselog.struggling %} 
             			       {% for exercise in exercises|get_item:subtopic.id %}
             			            {% if exercise.name = exerciselog.exercise_id %}
             			               <div> <a href= "{{ exercise.path }}"> {{exercise.title}} </a></div>
             			            {% endif %}
             			        {% endfor %}
             			    {% endif %}
             			{% endfor %}	 
            		</div>
                {% endif %}           
        <!-- {{stats|get_item:subtopic.id|get_item:"ex:pct_mastery" }} -->
            {% endif %}
            {% endfor %}
            </div>
 
            
        </div>
        
    {% endfor %}
    {% endif %}
<script>
$(function() {


	$(".progressindicator").click(function(ev){$("#"+$(ev.target).attr("subtopic")).show()})


})
</script>
    {% endblock student_report %}
{% endblock content %}
