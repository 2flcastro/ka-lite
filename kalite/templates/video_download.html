{% extends 'base_distributed.html' %}
{% block headcss %}
<link href="{{ STATIC_URL }}css/ui.dynatree.css"rel="stylesheet" type="text/css"/>
<style>
.download_buttons {
	padding: 5px 15px 10px 5px;
	width: 400px;
	float: left;
}

.vertical-shadow{
	width: 400px;
	height: 70px;
}	

.button_text{
	padding: 5px 0px 0px 10px; 
}

.button_style{
	padding: 0px 0px 10px 10px;
}


.progress_style{
	padding: 5px 0px 5px 0px;
}

.progress_text{
	color: #005987;
}

#progressbar{
	background-color:#005987;
}


</style>
{% endblock headcss %}
{% block headjs %}
<script src="{{ STATIC_URL }}js/jquery-ui.custom.min.js"></script>
<script src="{{ STATIC_URL }}js/jquery.dynatree.min.js"></script>


<script type="text/javascript">
  
   $(function(){ 
   	
   	$("#withSelected").hide();
   	$("#download_videos").hide();
   	
    doRequest("/api/get_topic_tree", {}, "POST").success(function(treeData) {
      
      $("#content_tree").dynatree({
        imagePath:"../images/",
        checkbox: true,
        selectMode: 3,
        children: treeData,
        onSelect: function(select, node) {
        
        	var numberOfVideos = findincomplete().length;
        	
        	if (numberOfVideos > 0){
        		$(".video_count").text(numberOfVideos);
        		$("#withSelected").show();
        		$("#noneSelected").hide();
        		$("#download_videos").show();
        	} else {
        		$("#noneSelected").show();
        		$("#withSelected").hide();
        		$("#download_videos").hide();
        	}
        	

        },
        onDblClick: function(node, event) {
          node.toggleSelect();
        },
        onKeydown: function(node, event) {
          if( event.which == 32 ) {
            node.toggleSelect();
            return false;
          }
        },
      });
          
    });
  
    $("#progressbar").progressbar({
      value: 37
    });
  
  });
  
	function findincomplete(){
      	var arr = $("#content_tree").dynatree("getSelectedNodes");
      	var arr_incomplete =  $.grep(arr, function(node){	
      		return !$(node.span).hasClass("complete") && node.childList == null; 
      	});
      	
      	return arr_incomplete;
	}
	
	function setNodeClass(nodeKey,className){
		var node = $("#content_tree").dynatree("getTree").getNodeByKey(nodeKey);
		var $span = $(node.span);
		$span.removeClass("unstarted partial complete").addClass(className);
	}
  
</script>

{% endblock headjs %}

{% block content %}

<!-- Dowanload Button -->

<div class="download_buttons">
	<div class="vertical-shadow suggested-action">
        <h2 id="noneSelected" class="button_text">Please select videos to download (below)</h2>
        <h2 id="withSelected" class="button_text">Download <span class="video_count">0</span> video selected below </h2>
        
	<span class= "button_style"><button id="download_videos" type="button">Download Selected Videos</button></span>

	</div>
</div>


<div class="download_buttons">
	<div class="vertical-shadow suggested-action">
	<h2 class="button_text">Download/update subtitles for all videos</h2>

<span class= "button_style">
	<select id="language">
	  <option value="chinese">English</option>
	  <option value="chinese">Chinese</option>
	  <option value="spanish">Spanish</option>
	  <option value="French">French</option>
	  <option value="japanese">Japanese</option>
	</select>
</span>

	<button id="download_subtitles" type="button">Download Subtitles </button>
	
	
	</div>
</div>


<!-- End -->



  <div style="clear: both;"> </div>



<div class="progress_style">
	
<h2 id="withSelected" class="progress_text">Downloading <span class="downloding_video">Linear Algebra</span></h2>

<div id="progressbar"> </div>

</div>


  
  <div id="content_tree"></div>
{% endblock content %}

